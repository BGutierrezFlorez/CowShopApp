<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>App Comercio</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
    crossorigin="anonymous"
  />

  <!-- Bootstrap Icons -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    rel="stylesheet"
  />

  <!-- Estilos personalizados -->
  <link rel="stylesheet" href="../../css/estilos.css" />

  <!-- Ajustes específicos para el perfil -->
  <style>
    .profile-container span i {
      transition: transform 0.2s ease, color 0.2s ease;
      cursor: pointer;
    }
    .profile-container span:hover i {
      transform: scale(1.2);
      color: #0d6efd;
    }
    .profile-container .user-info .name {
      font-size: 0.95rem;
      margin-top: 0.25rem;
    }
    .profile-container .user-info .role {
      font-size: 0.8rem;
      color: #6c757d;
    }
  </style>
</head>

<body>
  <!-- Panel lateral -->
  <div class="sidebar d-flex flex-column">
    <!-- Logo -->
    <div class="logo-container px-3 py-4">
      <img
        src="../../assets/img/logotipo.png"
        alt="Logo Empresa"
        class="img-fluid"
      />
    </div>

    <!-- Perfil interactivo -->
    <div
      class="profile-container dropdown text-center px-3 pb-4"
    >
      <a
        href="#"
        id="profileDropdown"
        class="d-flex align-items-center justify-content-center"
        data-bs-toggle="dropdown"
        aria-expanded="false"
      >
        <span
          data-bs-toggle="tooltip"
          data-bs-placement="right"
          title="Opciones de usuario"
        >
          <i class="bi bi-person-circle fs-1 text-secondary"></i>
        </span>
      </a>
      <div class="user-info">
        <span class="name d-block fw-semibold">–</span>
        <span class="role d-block">–</span>
      </div>
      <ul
        class="dropdown-menu dropdown-menu-end shadow-sm mt-2"
        aria-labelledby="profileDropdown"
      >
        <li><h6 class="dropdown-header">–</h6></li>
        <li><span class="dropdown-item-text">–</span></li>
        <li><hr class="dropdown-divider" /></li>
        <li>
          <a
            class="dropdown-item text-danger"
            href="#"
            onclick="logout()"
          >
            Cerrar Sesión
          </a>
        </li>
      </ul>
    </div>

    <!-- Menú de navegación
    <a
      class="menu-item d-flex align-items-center"
      data-section="home"
      onclick="showSection(this)"
    >
      <i class="bi bi-house-door-fill me-2"></i>Inicio
    </a> -->
    <a
      class="menu-item d-flex align-items-center"
      data-section="user"
      onclick="showSection(this)"
    >
      <i class="bi bi-people-fill me-2"></i>Gestión de Usuarios
    </a>
    <a
      class="menu-item d-flex align-items-center"
      data-section="catalogo"
      onclick="showSection(this)"
    >
      <i class="bi bi-basket3-fill me-2"></i>Gestionar Vacas
    </a>
    <a
      class="menu-item d-flex align-items-center"
      data-section="membresias"
      onclick="showSection(this)"
    >
      <i class="bi bi-credit-card-2-front-fill me-2"></i>Membresías
    </a>
    <a
      class="menu-item d-flex align-items-center"
      data-section="ventas"
      onclick="showSection(this)"
    >
      <i class="bi bi-cash-stack me-2"></i>Ventas
    </a>
    <!-- <a data-section="admin"> eliminado -->
    <a
      class="menu-item d-flex align-items-center"
      data-section="roles"
      onclick="showSection(this)"
    >
      <i class="bi bi-shield-lock-fill me-2"></i>Gestión de Roles
    </a>
    <!-- <a
      class="menu-item d-flex align-items-center"
      data-section="ofertas"
      onclick="showSection(this)"
    >
      <i class="bi bi-tag-fill me-2"></i>Promociones y ofertas
    </a>
    <a
      class="menu-item d-flex align-items-center"
      data-section="extras"
      onclick="showSection(this)"
    >
      <i class="bi bi-star-fill me-2"></i>Extras recomendados
    </a> -->

    <!-- Botones al final -->
    <div class="mt-auto p-3">
      <button
        class="btn btn-outline-danger w-100 mb-2 d-flex align-items-center justify-content-center"
        onclick="logout()"
      >
        <i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesión
      </button>
      <button
        class="btn btn-primary w-100 d-flex align-items-center justify-content-center"
      >
        <i class="bi bi-twitter me-2"></i>Twittear
      </button>
    </div>
  </div>

  <!-- Contenido principal -->
  <div class="main-content">
    <div class="header">Panel de Comercio</div>
    <div class="content">
      <!-- Home -->
      <div id="homeSection" style="display:none;">
        Bienvenido a tu panel de administración comercial.
      </div>

      <!-- Usuarios -->
      <div id="userSection" style="display:none;">
        <iframe
          src="../usuarios/index.html"
          style="width:100%; height:80vh; border:none;"
        ></iframe>
      </div>

      <!-- Vacas -->
      <div id="catalogoSection" style="display:none;">
        <iframe
          src="../productos/index.html"
          style="width:100%; height:80vh; border:none;"
        ></iframe>
      </div>
      
      <!-- Membresías -->
      <div id="membresiasSection" style="display:none;">
        <iframe
          src="../membresias/index.html"
          style="width:100%; height:80vh; border:none;"
        ></iframe>
      </div>

      <!-- Ventas -->
       
      <div
        id="ventasSection"
        style="display:none; background-color:#f8f9fa; padding:1rem;"
      >
        <iframe
          src="../ventas/index.html"
          style="width:100%; height:80vh; border:1px solid #dee2e6;"
        ></iframe>
      </div>
      
      <!-- Gestión de Roles -->
      <div id="rolesSection" style="display:none;">
        <iframe
          src="../roles/index.html"
          style="width:100%; height:80vh; border:none;"
        ></iframe>
      </div>
    </div>
    <footer>© 2025 Cowshop. Todos los derechos reservados.</footer>
  </div>

  <script>
    // Mostrar información básica del token en el perfil (si existe)
    (function() {
      try {
        const token = localStorage.getItem('cowshop_token');
        if (!token) return;

        // Decodificar payload del JWT (sin verificar firma) para mostrar id y rol
        const payload = JSON.parse(atob(token.split('.')[1]));
        const nameEl = document.querySelector('.profile-container .user-info .name');
        const roleEl = document.querySelector('.profile-container .user-info .role');
        if (nameEl) nameEl.textContent = 'Usuario #' + (payload.id || '');
        if (roleEl) roleEl.textContent = (payload.rol || '');
      } catch (e) {
        console.error('No se pudo leer token:', e);
      }
    })();

    function logout() {
      localStorage.removeItem('cowshop_token');
      localStorage.removeItem('cowshop_user_name');
      window.location.href = '../../../login.html';
    }
  </script>

  <!-- JavaScript funcional -->
  <script>
    const currentUser = { name: "Juan Pérez", role: "Administrador" };

    function showSection(el) {
      const section = el.dataset.section;

      const sections = [
        "home",
        "user",
        "catalogo",
        "membresias",
        "ventas",
        "ofertas",
        "extras",
        "roles",
      ];

      sections.forEach((id) => {
        const sec = document.getElementById(id + "Section");
        if (sec) sec.style.display = "none";
      });

      const target = document.getElementById(section + "Section");
      if (target) {
        target.style.display = "block";
      } else {
        console.warn("No existe la sección:", section + "Section");
      }

      document
        .querySelectorAll(".menu-item")
        .forEach((i) => i.classList.remove("active"));
      el.classList.add("active");
      localStorage.setItem("ultimaSeccion", section);
    }

    function logout() {
      localStorage.clear();
      window.location.href = "/login.html";
    }

    window.addEventListener("DOMContentLoaded", () => {
      const ultima = localStorage.getItem("ultimaSeccion") || "home";
      const defaultItem = document.querySelector(
        `.menu-item[data-section="${ultima}"]`
      );
      if (defaultItem) showSection(defaultItem);

      Array.from(
        document.querySelectorAll('[data-bs-toggle="tooltip"]')
      ).forEach((el) => new bootstrap.Tooltip(el));

      document.querySelector(
        ".profile-container .name"
      ).textContent = currentUser.name;
      document.querySelector(
        ".profile-container .role"
      ).textContent = currentUser.role;
      document.querySelector(".dropdown-header").textContent =
        currentUser.name;
      document.querySelector(".dropdown-item-text").textContent =
        currentUser.role;
    });
  </script>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
    integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y"
    crossorigin="anonymous"
  ></script>
</body>
</html>